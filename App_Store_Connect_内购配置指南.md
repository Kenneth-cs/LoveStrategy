# App Store Connect 内购配置指南

> **目标**: 在 App Store Connect 中配置3个消耗型内购商品  
> **前置条件**: 已有 Apple Developer 账号

---

## 📋 内购商品清单

| 产品ID | 名称 | 价格 | 桃花签数量 | 类型 |
|:---|:---|:---:|:---:|:---|
| `com.lovestrategy.coins.tier1` | 尝鲜包 | ¥5.8 | 60签 | 消耗型 |
| `com.lovestrategy.coins.tier2` | 超值包 | ¥17.8 | 200签 | 消耗型 |
| `com.lovestrategy.coins.tier3` | 尊享包 | ¥67.8 | 800签 | 消耗型 |

---

## 🔧 配置步骤

### 第1步：登录 App Store Connect

1. 访问 [App Store Connect](https://appstoreconnect.apple.com)
2. 使用你的 Apple ID 登录
3. 点击 **"我的 App"**
4. 选择 **"恋爱军师"** App

---

### 第2步：进入 App 内购买项目

1. 在左侧菜单找到 **"App 内购买项目"**
2. 点击 **"+"** 按钮（创建新的 App 内购买项目）

---

### 第3步：创建第1个商品（尝鲜包）

#### 3.1 选择类型
- **类型**: 选择 **"消耗型项目"**
- 点击 **"创建"**

#### 3.2 填写基本信息

**参考名称**（内部使用，用户看不到）:
```
桃花签尝鲜包
```

**产品 ID**（必须与代码一致）:
```
com.lovestrategy.coins.tier1
```

⚠️ **重要**: 产品ID必须与代码中的完全一致，创建后**不可修改**！

#### 3.3 填写价格和可用性

**价格**:
- 选择 **"人民币 (CNY)"**
- 输入 **"5.8"**（¥5.80）

或者选择价格等级：
- 价格等级：**等级 5.8** 或自定义价格（¥5.80）

**可用性**:
- 选择 **"在所有地区提供"**

#### 3.4 填写本地化信息（简体中文）

点击 **"添加本地化信息"** → 选择 **"简体中文"**

**显示名称**（用户看到的）:
```
尝鲜包
```

**描述**（详细说明）:
```
购买60个桃花签，只要一瓶奶茶钱，救急专用！

内含：
• 60个桃花签
• 可使用高情商回复助手约20次
• 可使用鉴渣雷达约7次
• 可使用截图起卦约7次
```

#### 3.5 审核信息

**审核备注**（可选）:
```
这是消耗型虚拟货币"桃花签"的充值商品。
用户购买后可以使用App内的AI分析功能。
1个桃花签 ≈ ¥0.1
```

#### 3.6 保存

- 点击右上角 **"存储"** 按钮
- 状态会显示为 **"准备提交"**（黄色）

---

### 第4步：创建第2个商品（超值包）

重复第3步，使用以下信息：

**参考名称**:
```
桃花签超值包
```

**产品 ID**:
```
com.lovestrategy.coins.tier2
```

**价格**:
```
¥17.8（自定义价格 ¥17.80）
```

**显示名称**（简体中文）:
```
超值包
```

**描述**（简体中文）:
```
购买200个桃花签，额外赠送20签，最划算的选择！

内含：
• 200个桃花签（+20签赠送）
• 可使用高情商回复助手约66次
• 可使用鉴渣雷达约25次
• 可使用截图起卦约25次

💰 单价更低，超值优惠！
```

---

### 第5步：创建第3个商品（尊享包）

重复第3步，使用以下信息：

**参考名称**:
```
桃花签尊享包
```

**产品 ID**:
```
com.lovestrategy.coins.tier3
```

**价格**:
```
¥67.8（自定义价格 ¥67.80）
```

**显示名称**（简体中文）:
```
尊享包
```

**描述**（简体中文）:
```
购买800个桃花签，额外赠送120签，超值大礼包！

内含：
• 800个桃花签（+120签赠送）
• 可使用高情商回复助手约266次
• 可使用鉴渣雷达约100次
• 可使用截图起卦约100次

👑 尊享用户专属，性价比之王！
```

---

## 📸 截图要求（可选但推荐）

为了通过审核更顺利，建议为每个商品上传截图：

**截图规格**:
- 尺寸: 640 × 920 px
- 格式: PNG 或 JPG
- 内容: 展示充值界面，标注该商品

**截图示例文案**:
```
尝鲜包截图文案：
"只需¥5.8，获得60个桃花签
快速体验AI恋爱军师的智慧"

超值包截图文案：
"¥17.8超值套餐，赠送20签
最受欢迎的选择"

尊享包截图文案：
"¥67.8尊享大礼包，赠送120签
一次购买，长期无忧"
```

---

## ✅ 检查清单

配置完成后，确认以下内容：

- [ ] 3个商品全部创建完成
- [ ] 产品ID与代码一致
  - [ ] `com.lovestrategy.coins.tier1`
  - [ ] `com.lovestrategy.coins.tier2`
  - [ ] `com.lovestrategy.coins.tier3`
- [ ] 价格设置正确（¥5.8、¥17.8、¥67.8）
- [ ] 简体中文本地化信息已填写
- [ ] 状态显示为"准备提交"
- [ ] （可选）截图已上传

---

## 🧪 沙盒测试配置

### 创建沙盒测试账号

1. **进入"用户和访问"**
   - 在 App Store Connect 首页
   - 点击顶部的 **"用户和访问"**

2. **创建沙盒测试员**
   - 选择 **"沙盒技术测试员"**
   - 点击 **"+"** 按钮

3. **填写测试员信息**
   ```
   名字: 测试
   姓氏: 用户
   电子邮件: testlove@qq.com
   密码: Test@123456
   确认密码: Test@123456
   ```

   ⚠️ 注意：
   - 邮箱必须是**未注册过 Apple ID** 的
   - 可以使用 Gmail 的 `+` 技巧创建多个测试账号
   - 例如: `yourname+test1@gmail.com`

4. **选择地区**
   - 地区: **中国**
   - App Store 地区: **中国**

5. **保存**

### 使用沙盒账号测试

1. **在设备上退出 App Store**
   - 设置 → App Store → 退出登录

2. **运行App进行测试**
   - 在 Xcode 中运行 App
   - 不要提前登录沙盒账号

3. **首次购买时登录**
   - 点击充值按钮
   - 系统会提示登录
   - 输入沙盒测试账号
   - **勾选"使用现有 Apple ID"**
   - 输入沙盒测试账号和密码

4. **确认购买**
   - 会显示 **[沙盒环境]** 标记
   - 价格为设置的价格
   - 点击确认购买
   - **沙盒环境不会真实扣款**

5. **测试完成后**
   - 设置 → App Store → 退出沙盒账号
   - 重新登录你的真实 Apple ID

---

## ⚠️ 注意事项

### 1. 产品ID不可修改
一旦创建，产品ID永久不可更改。请仔细检查后再创建。

### 2. 价格调整
创建后可以随时修改价格，但需要重新提交审核。

### 3. 消耗型商品特点
- 每次购买都会生成新交易
- 用户可以多次购买
- 不需要"恢复购买"功能
- 不会显示在用户的购买历史中

### 4. 审核时间
- 首次提交内购：约1-3天审核
- 更新内购信息：约1-2天
- 与App一起提交：随App审核

### 5. 测试环境
- 沙盒环境：免费测试，不扣款
- 生产环境：真实扣款

---

## 🚀 提交审核

### 提交流程

1. **将商品与App版本关联**
   - 在"App 信息" → "App 内购买项目"
   - 添加刚创建的3个商品

2. **提交App审核时**
   - 在"版本信息"中
   - 会自动包含"准备提交"状态的内购商品

3. **审核通过后**
   - 商品状态变为"已批准"（绿色）
   - 用户可以正常购买

---

## 📞 常见问题

### Q1: 产品ID写错了怎么办？
A: 无法修改，只能删除重建。建议先在代码中定义好ID，再到后台配置。

### Q2: 为什么商品加载不出来？
A: 
1. 检查产品ID是否一致
2. 确认商品状态为"准备提交"或"已批准"
3. 等待几分钟，App Store 缓存更新需要时间
4. 重启App重试

### Q3: 沙盒购买失败？
A:
1. 确认已退出真实 Apple ID
2. 确认使用的是沙盒测试账号
3. 检查网络连接
4. 尝试重启设备

### Q4: 审核被拒怎么办？
A: 常见原因：
- 商品描述不清晰 → 补充详细说明
- 截图不符合要求 → 重新上传
- 价格不合理 → 调整价格
- 功能未实现 → 完善代码

---

## ✅ 完成

配置完成后，你的充值系统就可以正常工作了！

**下一步**:
1. 在 Xcode 中将 `useSimulatedPurchase` 设为 `false`
2. 使用沙盒账号测试购买流程
3. 确认购买后桃花签正确到账
4. 提交App审核

---

**祝你顺利上线！** 🎉

